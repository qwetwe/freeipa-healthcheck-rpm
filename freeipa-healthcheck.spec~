%define oname python3-module-freeipa-healthcheck
%define docname ipahealthcheck
#%%define version 0.5

Name: %oname
Version: 0.5
Release: alt1

Summary: Check the health of a FreeIPA installation
License: GPLv3
Group: System/Base
Url: https://github.com/freeipa/freeipa-healthcheck

Source0: %name-%version.tar.gz

Requires: freeipa-server
Requires: python3-module-freeipa
Requires: python3-module-ipaserver
Requires: anacron
Requires: logrotate

BuildRequires: python3-dev
BuildRequires: libsystemd-devel
BuildRequires: python3-module-pytest-runner
BuildRequires: python3-module-freeipa
BuildRequires: python3-module-ipaserver
BuildRequires: python3-module-lib389
BuildRequires: python3-module-sss_nss_idmap


%description
FreeIPA-healthcheck is a framework which is needed to assist with the
identification, diagnosis and potentially repair of problems.


%prep
%setup

%build
%python3_build

%install
%python3_install

%check
sed -i '/\[testenv\]/a whitelist_externals =\
   \/bin\/cp\
  39    \/bin\/sed\
  40 commands_pre =\
  41    \/bin\/cp %_bindir\/py.test3 \{envbindir\}\/py.test\
  42    \/bin\/sed -i \x271c #!\{envpython\}\x27 \{envbindir\}\/py.test' tox.ini
  43 export PIP_NO_INDEX=YES
  44 export TOX_TESTENV_PASSENV='PIP_NO_INDEX'
  45 export TOXENV=py%{python_version_nodots python3}
  46 tox.py3 --sitepackages -v

%files
%doc COPYING README.md
%python3_sitelibdir_noarch/%docname

%changelog
* Fri Feb 07 2020 Ivan Alekseev <qwetwe@altlinux.org> 0.5-alt1
- Initial build

